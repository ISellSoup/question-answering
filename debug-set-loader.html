<!DOCTYPE html>
<html>
    <head>
        <script>
            const urlParams = new URLSearchParams(window.location.search);
            const setName = (new String(urlParams.get("setName"))).toString();
            const setType = urlParams.get("setType") ?? "built-in";
            const setLoadedEvent = new Event("application:setLoaded");
            
            let loadedSet = null;

            try {
                if (setType=="built-in") {
                    console.log('Loading module "jsonFetch.js"');

                    import('/modules/jsonFetch.js')
                    .then((async (response) => {
                        console.log('Module "jsonFetch.js" loaded', "Fetching built-in set:", setName);

                        loadedSet = await response.fetchBuiltInSet(setName);
                        window.dispatchEvent(setLoadedEvent);
                    }))
                    .catch((error) => {

                        console.error('Error loading module "jsonFetch.js":', error);
                        throw "";
                    });
                } else if (setType=="local") {
                    console.log("Parsing local set:", setName);

                    loadedSet = JSON.parse(localStorage.getItem(`placeholder`));
                    window.dispatchEvent(setLoadedEvent);
                } else {
                    console.error("Unknown set type:", setType);
                    throw "";
                }

            } catch (err) {
                console.warn(`Failed to load set "${setName}" of type "${setType}"`)

                document.body.innerHTML += `<h1>Failed to load ${setType} set "${setName}"</h1>`
            }
        </script>
        <script>
            window.addEventListener('application:setLoaded', () => {
                console.log('Set loaded:', loadedSet);

                document.body.innerHTML += `<h1>Loaded set: ${loadedSet.displayName}</h1>`
            });
        </script>
        <link rel="stylesheet" href="/styles/global.css">
    </head>
    <body>
        <button onclick="console.log('click')">Print</button>
    </body>
</html>